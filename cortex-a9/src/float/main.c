
#include "param.h"
#include "calculate.h"
int main(){

	float  img_data[] ={0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.196078,0.878431,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.274510,0.113725,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.474510,0.905882,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.580392,0.658824,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.015686,0.764706,0.905882,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.376471,0.823529,0.043137,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.270588,0.988235,0.525490,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.447059,0.988235,0.082353,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.176471,0.925490,0.850980,0.047059,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.752941,0.988235,0.082353,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.658824,0.968627,0.207843,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.070588,1.000000,0.992157,0.082353,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.329412,0.949020,0.827451,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.552941,0.992157,0.741176,0.019608,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.662745,0.988235,0.415686,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.125490,0.909804,0.980392,0.258824,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.058824,0.882353,0.988235,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.525490,0.988235,0.827451,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.086275,0.988235,0.643137,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.662745,0.988235,0.654902,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.035294,0.800000,0.819608,0.070588,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.086275,0.992157,0.992157,0.419608,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.662745,0.988235,0.780392,0.333333,0.333333,0.333333,0.333333,0.505882,0.643137,0.764706,0.988235,0.988235,0.415686,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.160784,0.666667,0.960784,0.988235,0.988235,0.988235,0.988235,0.909804,0.905882,0.984314,0.988235,0.988235,0.035294,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.192157,0.329412,0.329412,0.329412,0.329412,0.000000,0.000000,0.631373,0.988235,0.988235,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.498039,0.988235,0.988235,0.176471,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.501961,0.992157,0.992157,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.498039,0.988235,0.988235,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.529412,0.988235,0.956863,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.909804,0.925490,0.435294,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.701961,0.258824,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,};
	float *conv1_param_base =(float *) CNN1_PARAM_BASE;
	float* conv1_bias_base = (float *) CNN1_BIAS_BASE;
	float * conv1_result =  (float *)CNN1_RESULT_BASE;
	float * pooling1_result =  (float *) POOLING1_RESULT_BASE;  // 第一次卷积计算的结果会存入到当前的基地址的寄存器中

	float *conv2_param_base =(float *) CNN2_PARAM_BASE;
	float* conv2_bias_base = (float *) CNN2_BIAS_BASE;
	float * conv2_result =  (float *)CNN2_RESULT_BASE;
	float * pooling2_result =  (float *) POOLING2_RESULT_BASE;  // 第一次卷积计算的结果会存入到当前的基地址的寄存器中

	float *conv3_param_base =(float *) CNN3_PARAM_BASE;
	float* conv3_bias_base = (float *) CNN3_BIAS_BASE;
	float * conv3_result =  (float *)CNN3_RESULT_BASE;


	float* fc1_param_base = (float *)  FC1_PARAM_BASE;
	float *fc1_bias_base = (float *)  FC1_BIAS_BASE;
	float * fc1_result =  (float*)FC1_RESULT_BASE;

	float* fc2_param_base = (float*)  FC2_PARAM_BASE;
	float* fc2_bias_base = (float *) FC2_BIAS_BASE;
	float * fc2_result =  (float *)FC2_RESULT_BASE;

	  // 第一次卷积计算的结果会存入到当前的基地址的寄存器中



	int o_row1 = cal_ofmap_rows(INFMAP_ROWS , PADDING ,  CONV_KERNEL ,CONV_STRIDE1);
	int o_col1 =  cal_ofmap_cols(INFMAP_COLS,PADDING, CONV_KERNEL  ,CONV_STRIDE1);

	int in_row_pooling_1 = o_row1;
	int in_col_pooling_1 = o_col1;

	int  o_row_1_pooling = cal_ofmap_rows(in_row_pooling_1 , PADDING ,  POOLING_KERNEL ,POOLING_STRIDE);
	int  o_col_1_pooling =  cal_ofmap_cols(in_col_pooling_1,PADDING, POOLING_KERNEL , POOLING_STRIDE);

	int in_row_2 = o_row_1_pooling;
	int in_col_2 =  o_col_1_pooling;

	int o_row_2  = cal_ofmap_rows(in_row_2 , PADDING ,  CONV_KERNEL ,CONV_STRIDE1);
	int o_col_2 = cal_ofmap_cols(in_col_2 , PADDING ,  CONV_KERNEL ,CONV_STRIDE1);

	int o_row_2_pooling  = cal_ofmap_rows( o_row_2 , PADDING ,  POOLING_KERNEL ,POOLING_STRIDE);
	int o_col_2_pooling = cal_ofmap_cols(o_col_2 , PADDING, POOLING_KERNEL , POOLING_STRIDE);






	int result =0;
	float max_value=0;
	u64  begin_time = 0 ;
	u64 end_time = 0;
	long int temp_time = 0;
	float time_cost = 0 ;
	float temp [10];


	 load_param_conv1();

	 load_param_bias1();

	 load_param_conv2();

	 load_param_bias2();

	 load_param_conv3();
	 load_param_bias3();
	 load_param_fc1();
	 load_param_fc_bias1();
	 load_param_fc2();
	 load_param_fc_bias2();

float cnt =0 ;



while(1){

	XTime_GetTime(&begin_time);
	conv_layer ( conv1_result , INFMAP_ROWS,INFMAP_COLS, o_row1,o_col1, CONV_KERNEL, KERNEL_NUM1 ,  CONV_STRIDE1, IN_CHANNEL1,  img_data , conv1_param_base,  conv1_bias_base);


	pooling_layer  (pooling1_result,in_row_pooling_1 , in_col_pooling_1,KERNEL_NUM1, o_row_1_pooling, o_col_1_pooling,POOLING_KERNEL, POOLING_STRIDE,  conv1_result);


	conv_layer ( conv2_result , in_row_2,in_col_2, o_row_2,o_col_2, CONV_KERNEL, KERNEL_NUM2 ,  CONV_STRIDE1, IN_CHANNEL2, pooling1_result , conv2_param_base,  conv2_bias_base);


	pooling_layer  (pooling2_result,o_row_2 , o_col_2,KERNEL_NUM2, o_row_2_pooling, o_col_2_pooling,POOLING_KERNEL, POOLING_STRIDE,  conv2_result);



	fc_layer ( conv3_result, IN_NEURON , OUT_NEURON , pooling2_result,  conv3_param_base,  conv3_bias_base);

	fc_layer(fc1_result,IN_NEURON1  ,OUT_NEURON1 , conv3_result, fc1_param_base, fc1_bias_base);


	fc_layer_without_relu(fc2_result,IN_NEURON2  ,OUT_NEURON2 ,fc1_result, fc2_param_base, fc2_bias_base);

	for(int a=0; a<=OUT_NEURON2-1; a++ ){
		if(a==0){

			result =a;
			max_value = fc2_result[a];
		}

		else if(fc2_result [a] >= max_value)
		{
			result = a;
			max_value = fc2_result[a];
		}

		else {

			result = result;
			max_value = max_value;
		}



		}

	XTime_GetTime(&end_time);
	temp_time = (end_time-begin_time);
	time_cost = ((float)(temp_time)/COUNTS_PER_SECOND);


	for (int l=0 ; l <=10-1;l++){

			temp[l] = fc2_result[l];

		}
	cnt = cnt+1;


}




/*XTime_GetTime(&end_time);
temp_time = (end_time-begin_time);
time_cost = ((float)(temp_time)/COUNTS_PER_SECOND)/cnt;*/

for (int l=0 ; l <=10-1;l++){

		temp[l] = fc2_result[l];

	}





	return 0;
}
